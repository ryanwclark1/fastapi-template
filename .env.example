# ==============================================================================
# FastAPI Template Â· Local Development Environment
# ==============================================================================
# Copy this file to `.env` and tweak values for your workstation. The defaults
# assume you're running supporting services via deployment/docker/docker-compose.yml
# but keeping the FastAPI app on the host. Switch `localhost` to the container
# name (db, redis, rabbitmq, alloy) when you run the API inside Docker.
#
# Quick start:
#   1. cp .env.example .env
#   2. docker compose -f deployment/docker/docker-compose.yml up db redis rabbitmq
#   3. uv run fastapi dev example_service/main.py
# ==============================================================================

# ------------------------------------------------------------------------------
# Application Settings (APP_)
# ------------------------------------------------------------------------------
APP_SERVICE_NAME=example-service
APP_TITLE=Example Service API
APP_DESCRIPTION=FastAPI service template following standard architecture patterns
APP_VERSION=1.0.0
APP_ENVIRONMENT=development
APP_DEBUG=true
APP_HOST=0.0.0.0
APP_PORT=8000
APP_API_PREFIX=/api/v1
APP_DOCS_URL=/docs
APP_REDOC_URL=/redoc
APP_OPENAPI_URL=/openapi.json
APP_DISABLE_DOCS=false
APP_ROOT_PATH=
APP_ROOT_PATH_IN_SERVERS=true
APP_CORS_ORIGINS=["http://localhost:3000"]
APP_CORS_ALLOW_CREDENTIALS=true
APP_CORS_ALLOW_METHODS=["*"]
APP_CORS_ALLOW_HEADERS=["*"]
APP_ENABLE_REQUEST_SIZE_LIMIT=true
APP_REQUEST_SIZE_LIMIT=10485760
APP_ENABLE_RATE_LIMITING=false
APP_RATE_LIMIT_PER_MINUTE=120
APP_RATE_LIMIT_WINDOW_SECONDS=60
APP_REDIRECT_SLASHES=true
APP_SEPARATE_INPUT_OUTPUT_SCHEMAS=true

# ------------------------------------------------------------------------------
# Database Settings (DB_)
# ------------------------------------------------------------------------------
DB_ENABLED=true
DB_DSN=postgresql+psycopg://postgres:postgres@localhost:5432/example_service
# For dockerized FastAPI workloads, point at the compose service name instead:
# DB_DSN=postgresql+psycopg://postgres:postgres@db:5432/example_service
DB_APPLICATION_NAME=example-service
DB_ECHO=false
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30.0
DB_POOL_RECYCLE=1800
DB_CONNECT_TIMEOUT=5.0
DB_PG_MIN_SIZE=1
DB_PG_MAX_SIZE=10
DB_PG_TIMEOUT=30.0
DB_STARTUP_REQUIRE_DB=true
DB_STARTUP_RETRY_ATTEMPTS=3
DB_STARTUP_RETRY_DELAY=2.0
DB_STARTUP_RETRY_TIMEOUT=60.0

# Component overrides (used when DB_DSN is not set)
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=example_service

# ------------------------------------------------------------------------------
# Redis Cache Settings (REDIS_)
# ------------------------------------------------------------------------------
REDIS_REDIS_URL=redis://localhost:6379/0
# When FastAPI runs inside docker compose, change host to `redis`
# REDIS_REDIS_URL=redis://redis:6379/0
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_USERNAME=
REDIS_PASSWORD=
REDIS_KEY_PREFIX=example-service:
REDIS_DEFAULT_TTL=3600
REDIS_AUTH_TOKEN_TTL=300
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5.0
REDIS_SOCKET_CONNECT_TIMEOUT=5.0
REDIS_SOCKET_KEEPALIVE=true
REDIS_MAX_RETRIES=3
REDIS_RETRY_DELAY=0.5
REDIS_RETRY_TIMEOUT=10.0
REDIS_HEALTH_CHECKS_ENABLED=false
REDIS_STARTUP_REQUIRE_CACHE=false

# ------------------------------------------------------------------------------
# RabbitMQ Messaging Settings (RABBIT_)
# ------------------------------------------------------------------------------
RABBIT_ENABLED=true
RABBIT_AMQP_URI=amqp://admin:admin123@localhost:5672/
# For docker compose, point to the service name:
# RABBIT_AMQP_URI=amqp://admin:admin123@rabbitmq:5672/
RABBIT_CONNECTION_NAME=example-service-local
RABBIT_QUEUE_PREFIX=example-service
RABBIT_DEFAULT_QUEUE=tasks
RABBIT_EXCHANGE_NAME=example-service
RABBIT_EXCHANGE_TYPE=topic
RABBIT_PREFETCH_COUNT=100
RABBIT_MAX_CONSUMERS=10
RABBIT_POOL_SIZE=10
RABBIT_PUBLISHER_CONFIRMS=true
RABBIT_HEARTBEAT=60
RABBIT_RETRY_ATTEMPTS=5
RABBIT_RETRY_BACKOFF=1.0
RABBIT_GRACEFUL_TIMEOUT=15.0

# ------------------------------------------------------------------------------
# External Authentication Settings (AUTH_)
# ------------------------------------------------------------------------------
AUTH_SERVICE_URL=http://localhost:8001
AUTH_TOKEN_VALIDATION_ENDPOINT=/api/v1/auth/validate
AUTH_TOKEN_CACHE_TTL=300
AUTH_TOKEN_HEADER=Authorization
AUTH_TOKEN_SCHEME=Bearer
AUTH_REQUEST_TIMEOUT=5.0
AUTH_MAX_RETRIES=3
AUTH_ENABLE_PERMISSION_CACHING=true
AUTH_ENABLE_ROLE_CACHING=true
# AUTH_SERVICE_TOKEN=your-service-token
# AUTH_SERVICE_ID=example-service

# ------------------------------------------------------------------------------
# Logging Settings (LOG_)
# ------------------------------------------------------------------------------
LOG_SERVICE_NAME=example-service
LOG_LEVEL=DEBUG
LOG_JSON_LOGS=false
LOG_CONSOLE_ENABLED=true
LOG_CONSOLE_LEVEL=
LOG_FILE_ENABLED=true
LOG_FILE_PATH=logs/example-service.dev.log
LOG_FILE_MAX_BYTES=10485760
LOG_FILE_BACKUP_COUNT=5
LOG_INCLUDE_UVICORN=true
LOG_INCLUDE_REQUEST_ID=true
LOG_LOG_SLOW_REQUESTS=true
LOG_SLOW_REQUEST_THRESHOLD=1.0
LOG_CAPTURE_WARNINGS=true

# ------------------------------------------------------------------------------
# OpenTelemetry Settings (OTEL_)
# ------------------------------------------------------------------------------
OTEL_ENABLED=false
OTEL_ENDPOINT=http://localhost:4317
# When running the Alloy collector from docker compose, use:
# OTEL_ENDPOINT=http://alloy:4317
OTEL_SERVICE_NAME=example-service
OTEL_SERVICE_VERSION=1.0.0
OTEL_INSECURE=true
OTEL_SAMPLE_RATE=1.0
OTEL_INSTRUMENT_FASTAPI=true
OTEL_INSTRUMENT_HTTPX=true
OTEL_INSTRUMENT_SQLALCHEMY=true
OTEL_INSTRUMENT_PSYCOPG=true

# ------------------------------------------------------------------------------
# Backup Settings (BACKUP_)
# ------------------------------------------------------------------------------
BACKUP_ENABLED=false
BACKUP_LOCAL_DIR=./backups
BACKUP_RETENTION_DAYS=7
BACKUP_COMPRESSION=true
BACKUP_INCLUDE_BLOBS=true
# Configure these when mirroring backups into object storage
# BACKUP_S3_BUCKET=
# BACKUP_S3_ACCESS_KEY=
# BACKUP_S3_SECRET_KEY=
# BACKUP_S3_ENDPOINT_URL=http://localhost:9000
# BACKUP_S3_REGION=us-east-1
# BACKUP_S3_PREFIX=backups/database
# BACKUP_S3_RETENTION_DAYS=30

# ------------------------------------------------------------------------------
# Optional YAML/conf.d Overrides
# ------------------------------------------------------------------------------
# Uncomment the directories below to load layered YAML configuration before env
# variables. Files live under ./conf and are perfect for local toggles.
# APP_CONFIG_DIR=conf
# DB_CONFIG_DIR=conf
# REDIS_CONFIG_DIR=conf
# RABBIT_CONFIG_DIR=conf
# LOGGING_CONFIG_DIR=conf
# OTEL_CONFIG_DIR=conf

# Sensitive credentials should never be committed. Use your secret manager or
# keep overrides in a private, untracked .env.local if other developers share
# the same repository.
